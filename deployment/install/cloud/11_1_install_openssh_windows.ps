Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'
Set-Location $env:USERPROFILE
Set-Location Downloads
mkdir OpenSSH
Set-Location OpenSSH

# Download and exand
Invoke-WebRequest https://github.com/PowerShell/Win32-OpenSSH/releases/download/v1.0.0.0/OpenSSH-Win64.zip -OutFile openssh.zip
Expand-Archive openssh.zip 'C:\Program Files'
Set-Location "C:\Program Files\OpenSSH-Win64"

# Install
powershell.exe -ExecutionPolicy Bypass -File install-sshd.ps1

# Allow firewall
New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
netsh advfirewall firewall add rule name=sshd dir=in action=allow protocol=TCP localport=22

# Start and configure service
Start-Service sshd
Start-Service ssh-agent
Set-Service sshd -StartupType Automatic
Set-Service ssh-agent -StartupType Automatic

setx PATH "%PATH%;C:\Program Files\OpenSSH-Win64"
set PATH "%PATH%;C:\Program Files\OpenSSH-Win64"

.\ssh-keygen.exe
# Verifiy that ssh-agent is running before running the following command
.\ssh-add $env:USERPROFILE\.ssh\id_rsa