<div class="container">
    @if (table) {
        @if (loading) {
            <div>Loading...</div>
        }
        <div>
            <article class="table-header">
                <mat-form-field appearance="outline">
                    <input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Search">
                </mat-form-field>
                <button [ngClass]="{'fa fa fa-refresh action-button-reload' : true}" (click)="reloadContacts()"></button>
                <button [ngClass]="{'fa fa-pencil' : true, 'action-button-edit': !enableEditContacts, 'action-button-save': enableEditContacts, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="toggleEditContacts()"></button>
                <!-- <button [ngClass]="{'fa fa-plus' : true, 'action-button-add': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="addContact()"></button> -->
                
                <!-- <button [ngClass]="{'fa fa-minus' : true, 'action-button-delete': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="removeSelectedAirlines()"></button> -->
            </article>
            @if (enableEditContacts) {
                <app-profile-knows-editor></app-profile-knows-editor>
            }

            <table class="table-content" mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort #contactTableSort="matSort">

                @if (!isMobile) {
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                                        [checked]="selection.hasValue() && isAllSelected()"
                                        [indeterminate]="selection.hasValue() && !isAllSelected()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let airline">
                        <mat-checkbox (click)="$event.stopPropagation()"
                                        (change)="$event ? selection.toggle(airline) : null"
                                        [checked]="selection.isSelected(airline)">
                        </mat-checkbox>
                    </td>
                </ng-container>

                <ng-container matColumnDef="webId">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Web Id </th>
                    <td mat-cell *matCellDef="let contact" > {{contact.webId}}</td>
                </ng-container>
                }

                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                    <td mat-cell *matCellDef="let contact" > {{contact.name}}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="header-center"> Actions </th>
                    <td mat-cell *matCellDef="let contact">
                        @if(enableEditContacts) {
                            <button [ngClass]="{'fa fa-pencil' : true, 'action-button-add': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="editContact(contact)"></button>
                            <button [ngClass]="{'fa fa-minus-circle' : true, 'action-button-delete': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="removeContact(contact)"></button>
                            <!-- <button [ngClass]="{'fa fa-trash' : true, 'action-button-delete': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="removeContact(contact.webId)"></button> -->
                        } @else {
                            <button [ngClass]="{'fa fa-phone' : true, 'action-button-execute': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="callContact(contact)"></button>
                            <button [ngClass]="{'fa fa-comment-o' : true, 'action-button-execute': !isReadOnlyUser, 'action-button-disabled': isReadOnlyUser}" [disabled]="isReadOnlyUser" (click)="sendMessageContact(contact)"></button>
                        }
                    </td>
                </ng-container>
                
                @if (isMobile) {
                    <tr mat-header-row *matHeaderRowDef="displayColumnsMobile; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayColumnsMobile;"></tr>
                } @else {
                    <tr mat-header-row *matHeaderRowDef="displayColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayColumns;"></tr>
                }
                
                <!-- <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClicked(row)"></tr> -->
            </table>

            <mat-paginator #paginator
                (page)="handlePageEvent($event)"
                [length]="numberOfContacts"
                [pageSize]="pageSize"
                [disabled]="disabled"
                [showFirstLastButtons]="showFirstLastButtons"
                [pageSizeOptions]="showPageSizeOptions ? pageSizeOptions : []"
                [hidePageSize]="hidePageSize"
                [pageIndex]="pageIndex">
            </mat-paginator>
        </div>
    } @else {
        @if (loading) {
            <div>Loading...</div>
        }

        @for (person of peopleIKnow; track person.webId) {
            <div class="card">
                @if (person.img) {
                    <img [src]="person.img" alt="Photo" />
                }
                <div>
                    <strong>{{ person.name }}</strong><br />
                    <strong>{{ person.email }}</strong><br />
                    <small>{{ person.webId }}</small>
                    <mat-divider/>
                    <button (click)="removeContact(person)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </div>
        }
    }
</div>